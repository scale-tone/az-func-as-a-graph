<html>

<head>
    <meta charset="utf-8" />
    <title>{{PROJECT_NAME}}</title>

    <style>
        svg {
            display: block;
            margin: auto;
            width: 100% !important;
            height: 100% !important;
            font-weight: normal !important;
        }
    </style>

</head>

<a style="position: absolute; right: 0px; top: 0px;" href="https://github.com/scale-tone/az-func-as-a-graph#az-func-as-a-graph" target="_blank" rel="noreferrer">
    <img loading="lazy" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_white_ffffff.png?resize=149%2C149" alt="Fork me on GitHub" data-recalc-dims="1" />
</a>

<h1 style="text-align: center;" >{{PROJECT_NAME}}<h1>

{{GRAPH_SVG}}

<script>

    // This line will be replaced with the list of Functions by the generator script
    const functionsMap = {};
    const proxiesMap = {};

    function mountClickEventToFunctionNodes(nodes) {

        for (var i = 0; i < nodes.length; i++) {
            const el = nodes[i];

            const match = /flowchart-(.+)-/.exec(el.id);
            if (!!match) {

                const name = match[1];
                var filePath = '';

                if (name.startsWith('proxy.')) {

                    const proxy = proxiesMap[name.substr(6)];
                    if (!!proxy) {
                        filePath = proxy.filePath;
                    }
                }

                const func = functionsMap[name];
                if (!!func) {
                    filePath = func.filePath;
                }

                if (!!filePath) {
                    const closuredFilePath = filePath;
                    el.onclick = () => window.open(closuredFilePath);
                    el.style.cursor = 'pointer';
                }
            }
        }
    }

    // Mounting click handlers to diagram nodes.
    mountClickEventToFunctionNodes(document.getElementsByClassName('function'));
    mountClickEventToFunctionNodes(document.getElementsByClassName('orchestrator'));
    mountClickEventToFunctionNodes(document.getElementsByClassName('activity'));
    mountClickEventToFunctionNodes(document.getElementsByClassName('entity'));
    mountClickEventToFunctionNodes(document.getElementsByClassName('proxy'));

</script>

</html>