(()=>{"use strict";var e={1559:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemWrapper=void 0;const i=s(1398),n=s(5530);class r extends n.FileSystemWrapperBase{joinPath(e,t){return i.Uri.joinPath(i.Uri.parse(e),t).toString()}dirName(e){const t=e.lastIndexOf("/");if(t<0)throw new Error(`Failed to extract parent folder name from path ${e}. The path does not contain a separator.`);return e.substring(0,t)}async readFile(e){const t=i.Uri.parse(e),s=await i.workspace.fs.readFile(t);return(new TextDecoder).decode(s)}async isDirectory(e){const t=i.Uri.parse(e);return(await i.workspace.fs.stat(t)).type===i.FileType.Directory}async readDir(e){const t=i.Uri.parse(e);return(await i.workspace.fs.readDirectory(t)).map((e=>e[0]))}async pathExists(e){const t=i.Uri.parse(e);try{const e=await i.workspace.fs.stat(t);return e.type===i.FileType.File||e.type===i.FileType.Directory}catch(e){return!1}}}t.FileSystemWrapper=r},9900:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionGraphView=void 0;const i=s(1398),n=s(6955),r=s(1559);class a{constructor(e,t){this._context=e,this._functionProjectUri=t,this._webViewPanel=null,this._staticsFolder=i.Uri.joinPath(this._context.extensionUri,"HtmlStatics"),this._webViewPanel=this.showWebView()}cleanup(){this._webViewPanel&&this._webViewPanel.dispose()}showWebView(){const e=`Functions Graph (${this._functionProjectUri.fsPath})`,t=i.window.createWebviewPanel(a.viewType,e,i.ViewColumn.One,{retainContextWhenHidden:!0,enableScripts:!0,localResourceRoots:[this._staticsFolder]}),s=i.Uri.joinPath(this._staticsFolder,"index.html");return i.workspace.fs.readFile(s).then((e=>{let s=(new TextDecoder).decode(e);s=this.fixLinksToStatics(s,this._staticsFolder,t.webview),s=this.embedTheme(s),t.webview.html=s}),(e=>{i.window.showErrorMessage(`az-func-as-a-graph failed. ${e.message??e}`)})),t.webview.onDidReceiveMessage((e=>this.handleMessageFromWebView(t.webview,e)),void 0,this._context.subscriptions),t}embedTheme(e){return[2,3].includes(i.window.activeColorTheme.kind)?e.replace("<script>var ClientConfig={}<\/script>","<script>var ClientConfig={'theme':'dark'}<\/script>"):e}handleMessageFromWebView(e,t){switch(t.kind){case"ShowMessage":return void i.window.showInformationMessage(t.data);case"ShowError":return void i.window.showErrorMessage(`az-func-as-a-graph failed. ${t.data}`);case"SaveAs":return this.looksLikeSvg(t.data)?void i.window.showSaveDialog({defaultUri:i.Uri.file("func-map.svg"),filters:{"SVG Images":["svg"]}}).then((e=>{if(!e)return;const s=(new TextEncoder).encode(t.data);i.workspace.fs.writeFile(e,s).then((()=>{i.window.showInformationMessage(`SVG image saved to ${e}`)}),(e=>{i.window.showErrorMessage(`Failed to save. ${e.message??e}`)}))})):void i.window.showErrorMessage("Invalid data format. Save failed.");case"SaveFunctionGraphAsJson":if(!this._traversalResult)return;return void i.window.showSaveDialog({defaultUri:i.Uri.file("func-map.json"),filters:{JSON:["json"]}}).then((e=>{if(!e)return;const t=(new TextEncoder).encode(JSON.stringify(this._traversalResult,null,3));i.workspace.fs.writeFile(e,t).then((()=>{i.window.showInformationMessage(`Diagram JSON saved to ${e}`)}),(e=>{i.window.showErrorMessage(`Failed to save. ${e.message??e}`)}))}));case"GotoFunctionCode":if(!this._traversalResult)return;const a=t.data;var s;return s=a.startsWith("proxy.")?this._traversalResult.proxies[a.substr(6)]:this._traversalResult.functions[a],void i.window.showTextDocument(i.Uri.parse(s.filePath)).then((e=>{const t=e.document.positionAt(s.pos?s.pos:0);e.selection=new i.Selection(t,t),e.revealRange(new i.Range(t,t))}));case"Refresh":return void n.FunctionProjectParser.parseFunctions(this._functionProjectUri.toString(),new r.FileSystemWrapper,console.log).then((t=>{console.log(`>>>>>> ${this._functionProjectUri}: ${Object.keys(t.functions).length} functions`),this._traversalResult=t,e.postMessage(this._traversalResult)})).catch((t=>{this._traversalResult=void 0,e.postMessage(void 0),i.window.showErrorMessage(`az-func-as-a-graph failed. ${t.message??t}`)}))}}fixLinksToStatics(e,t,s){var n=e;const r=/ (href|src)="\/([0-9a-z.\/]+)"/gi;for(var a;a=r.exec(e);){const e=a[2],r=i.Uri.joinPath(t,e),o=s.asWebviewUri(r).toString();n=n.replace(`/${e}`,o)}return n}looksLikeSvg(e){return e.startsWith("<svg")&&e.endsWith("</svg>")&&!e.toLowerCase().includes("<script")}}t.FunctionGraphView=a,a.viewType="az-func-as-a-graph"},4046:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CSharpFunctionProjectParser=void 0;const i=s(9293),n=s(8466);class r extends n.FunctionProjectCodeParser{async getFunctionsAndTheirCodesAsync(e,t){const s=e.map((async e=>{const s=await this._fileSystemWrapper.findFileRecursivelyAsync(t,".+\\.cs$",!0,this.getFunctionStartRegex(e));if(!s)return;const n=s.pos?s.pos:0,r=(0,i.posToLineNr)(s.code,n);return{name:e,code:(0,i.getCodeInBrackets)(s.code,s.pos+s.length,"{","}","\n").code,filePath:s.filePath,pos:n,lineNr:r}}));return(await Promise.all(s)).filter((e=>!!e))}async traverseProjectCode(e){const t={},s=new RegExp(".+\\.cs$","i");for await(const i of this._fileSystemWrapper.findFunctionsRecursivelyAsync(e,s,this.getFunctionAttributeRegex())){const n=this.tryExtractBindings(i.declarationCode);n.some((e=>"orchestrationTrigger"===e.type))||n.some((e=>"entityTrigger"===e.type))||n.some((e=>"activityTrigger"===e.type))||n.push(...await this.extractOutputBindings(e,i.declarationCode,s)),t[i.functionName]={filePath:i.filePath,pos:i.pos,lineNr:i.lineNr,bindings:[...n]}}return t}async extractOutputBindings(e,t,s){const n=this.functionReturnTypeRegex.exec(t);if(!n)return[];const r=(0,i.removeNamespace)(n[3]);if(!r)return[];const a=await this._fileSystemWrapper.findFileRecursivelyAsync(e,s,!0,this.getClassDefinitionRegex(r));if(!a)return[];const o=(0,i.getCodeInBrackets)(a.code,(a.pos??0)+(a.length??0),"{","}");return o.code?this.tryExtractBindings(o.code):[]}}t.CSharpFunctionProjectParser=r},8377:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FSharpFunctionProjectParser=void 0;const i=s(9293),n=s(8466);class r extends n.FunctionProjectCodeParser{async getFunctionsAndTheirCodesAsync(e,t){const s=e.map((async e=>{const s=await this._fileSystemWrapper.findFileRecursivelyAsync(t,".+\\.fs$",!0,this.getFunctionStartRegex(e));if(!s)return;const n=(0,i.getCodeInBrackets)(s.code,s.pos+s.length,"{","}","\n").code,r=s.pos?s.pos:0,a=(0,i.posToLineNr)(s.code,r);return{name:e,code:n,filePath:s.filePath,pos:r,lineNr:a}}));return(await Promise.all(s)).filter((e=>!!e))}async traverseProjectCode(e){const t={};for await(const s of this._fileSystemWrapper.findFunctionsRecursivelyAsync(e,new RegExp(".+\\.fs$","i"),this.getFunctionAttributeRegex())){const e=this.tryExtractBindings(s.declarationCode);t[s.functionName]={filePath:s.filePath,pos:s.pos,lineNr:s.lineNr,bindings:[...e]}}return t}getFunctionAttributeRegex(){return{regex:new RegExp('\\[<\\s*Function(Name)?\\s*\\((["\\w\\s\\.\\(\\)-]+)\\)',"g"),pos:2}}}t.FSharpFunctionProjectParser=r},5530:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemWrapperBase=void 0;const i=s(9293),n=["node_modules","target","bin","obj",".vs",".vscode",".env",".python_packages",".git",".github"];t.FileSystemWrapperBase=class{async readFunctionsJson(e,t){let s={};const i=(await this.readDir(e)).map((async i=>{const n=this.joinPath(e,i),r=this.joinPath(n,"function.json"),a=await this.isDirectory(n),o=await this.pathExists(r);if(a&&o)try{const e=await this.readFile(r),t=JSON.parse(e);s[i]={bindings:t.bindings,isCalledBy:[],isSignalledBy:[]}}catch(e){t(`>>> Failed to parse ${r}: ${e}`)}}));return await Promise.all(i),s}async readProxiesJson(e,t){const s=this.joinPath(e,"proxies.json");if(!await this.pathExists(s))return{};const n=await this.readFile(s);try{const t=JSON.parse(n).proxies;if(!t)return{};var r=!1;if(await this.isCSharpProjectAsync(e)){const t=await this.findFileRecursivelyAsync(e,".+\\.csproj$",!0),s=new RegExp('\\s*=\\s*"proxies.json"\\s*>');t&&t.code&&!s.exec(t.code)&&(r=!0)}for(var a in t){const e=t[a];e.filePath=s,r&&(e.warningNotAddedToCsProjFile=!0);const o=new RegExp(`"${a}"\\s*:`).exec(n);o&&(e.pos=o.index,e.lineNr=(0,i.posToLineNr)(n,e.pos))}return t}catch(e){return t(`>>> Failed to parse ${s}: ${e}`),{}}}async isCSharpProjectAsync(e){return(await this.readDir(e)).some((e=>(e=e.toLowerCase()).endsWith(".csproj")&&"extensions.csproj"!==e))}async isFSharpProjectAsync(e){return(await this.readDir(e)).some((e=>(e=e.toLowerCase()).endsWith(".fsproj")))}async isJavaProjectAsync(e){return!!await this.findFileRecursivelyAsync(e,".+\\.java$",!1)}async isPowershellProjectAsync(e){const t=await this.findFileRecursivelyAsync(e,"function.json",!1);return!(!t||!t.filePath)&&!!await this.findFileRecursivelyAsync(this.dirName(t.filePath),".+\\.ps1$",!1)}async isPythonV2ProjectAsync(e){const t=await this.findFileRecursivelyAsync(e,".+\\.py$",!1),s=await this.findFileRecursivelyAsync(e,"function.json",!1);return!!t&&!s}async findFileRecursivelyAsync(e,t,s,i){const r="string"==typeof t?new RegExp(t,"i"):t,a=[];for(const t of await this.readDir(e)){const o=this.joinPath(e,t);if(await this.isDirectory(o))n.includes(t.toLowerCase())||a.push(o);else if(r.exec(t)){if(!i)return{filePath:o,code:s?await this.readFile(o):void 0};const e=await this.readFile(o),t=i.exec(e);if(t)return{filePath:o,code:s?e:void 0,pos:t.index,length:t[0].length}}}for(const e of a){const t=await this.findFileRecursivelyAsync(e,r,s,i);if(t)return t}}async*findFilesRecursivelyAsync(e,t){for(const i of await this.readDir(e)){var s=this.joinPath(e,i);if(await this.isDirectory(s)){if(n.includes(i.toLowerCase()))continue;for await(const e of this.findFilesRecursivelyAsync(s,t))yield e}else t.exec(i)&&(yield s)}}async*findFunctionsRecursivelyAsync(e,t,s){for await(const r of this.findFilesRecursivelyAsync(e,t)){const e=await this.readFile(r);for(var n;n=s.regex.exec(e);){let t=(0,i.cleanupFunctionName)(n[s.pos]);const a=n.index+n[0].length,o=(0,i.getCodeInBrackets)(e,a,"{","}","\n");if(!(o.openBracketPos>=0&&o.code)){yield{functionName:t,filePath:r,pos:n.index,lineNr:(0,i.posToLineNr)(e,n.index),declarationCode:e.substring(a),bodyCode:e.substring(a)};break}yield{functionName:t,filePath:r,pos:n.index,lineNr:(0,i.posToLineNr)(e,n.index),declarationCode:o.code.substring(0,o.openBracketPos),bodyCode:o.code.substring(o.openBracketPos)}}}}}},8466:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionProjectCodeParser=void 0;const i=s(5254);class n extends i.FunctionProjectParserBase{async traverseFunctions(e){let t;return t=await this.traverseProjectCode(e),t=await this.mapOrchestratorsAndActivitiesAsync(t,e),t}getFunctionStartRegex(e){return new RegExp(`Function(Name)?(Attribute)?\\s*\\(\\s*(nameof\\s*\\(\\s*|["'\`]|[\\w\\s\\.]+\\.\\s*)${e}\\s*["'\`\\)]{1}`)}getFunctionAttributeRegex(){return{regex:new RegExp('\\[\\s*Function(Name)?(Attribute)?\\s*\\((["\\w\\s\\.\\(\\)-]+)\\)\\s*\\]',"g"),pos:3}}}t.FunctionProjectCodeParser=n},6955:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionProjectParser=void 0;const i=s(6620),n=s(4046),r=s(8377),a=s(6315),o=s(9852),c=s(8249);t.FunctionProjectParser=class{static async parseFunctions(e,t,s){const u=await t.findFileRecursivelyAsync(e,"host.json",!1);if(!u)throw new Error("host.json file not found under the provided project path");s(`>>> Found host.json at ${u.filePath}`);const l=t.dirName(u.filePath);let g;return await t.isCSharpProjectAsync(l)?g=new n.CSharpFunctionProjectParser(t,s):await t.isFSharpProjectAsync(l)?g=new r.FSharpFunctionProjectParser(t,s):await t.isJavaProjectAsync(l)?g=new a.JavaFunctionProjectParser(t,s):await t.isPowershellProjectAsync(l)?g=new o.PowershellFunctionProjectParser(t,s):await t.isPythonV2ProjectAsync(l)?g=new c.PythonV2FunctionProjectParser(t,s):(g=new i.FunctionProjectScriptParser(t,s),e=l),{functions:await g.traverseFunctions(e),proxies:await t.readProxiesJson(e,s),projectFolder:e}}}},5254:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionProjectParserBase=void 0;const i=s(9293);t.FunctionProjectParserBase=class{constructor(e,t){this._fileSystemWrapper=e,this._log=t,this.singleParamRegex=new RegExp('("|nameof\\s*\\()?([\\w\\.-]+)'),this.eventHubParamsRegex=new RegExp('"([^"]+)"'),this.signalRParamsRegex=new RegExp('"([^"]+)"'),this.rabbitMqParamsRegex=new RegExp('"([^"]+)"'),this.blobParamsRegex=new RegExp('"([^"]+)"'),this.cosmosDbParamsRegex=new RegExp('"([^"]+)"(.|\r|\n)+?"([^"]+)"'),this.signalRConnInfoParamsRegex=new RegExp('"([^"]+)"'),this.eventGridParamsRegex=new RegExp('"([^"]+)"(.|\r|\n)+?"([^"]+)"'),this.isOutRegex=new RegExp("^\\s*\\]\\s*(out |ICollector|IAsyncCollector).*?(,|\\()","g"),this.httpMethods=["get","head","post","put","delete","connect","options","trace","patch"],this.httpTriggerRouteRegex=new RegExp('Route\\s*=\\s*"(.*)"'),this.functionReturnTypeRegex=new RegExp("public\\s*(static\\s*|async\\s*)*(Task\\s*<\\s*)?([\\w\\.]+)")}async mapOrchestratorsAndActivitiesAsync(e,t){const s=Object.keys(e),i=s.filter((t=>e[t].bindings.some((e=>"orchestrationTrigger"===e.type)))),n=await this.getFunctionsAndTheirCodesAsync(i,t),r=Object.keys(e).filter((t=>e[t].bindings.some((e=>"activityTrigger"===e.type)))),a=await this.getFunctionsAndTheirCodesAsync(r,t),o=s.filter((t=>e[t].bindings.some((e=>"entityTrigger"===e.type)))),c=await this.getFunctionsAndTheirCodesAsync(o,t),u=s.filter((t=>!e[t].bindings.some((e=>["orchestrationTrigger","activityTrigger","entityTrigger"].includes(e.type))))),l=await this.getFunctionsAndTheirCodesAsync(u,t);for(const t of n){const s=this.getStartNewOrchestrationRegex(t.name);for(const i of l)s.exec(i.code)&&(e[t.name].isCalledBy=e[t.name].isCalledBy??[],e[t.name].isCalledBy.push(i.name));for(const s of n)t.name!==s.name&&this.getCallSubOrchestratorRegex(s.name).exec(t.code)&&(e[s.name].isCalledBy=e[s.name].isCalledBy??[],e[s.name].isCalledBy.push(t.name));this.mapActivitiesToOrchestrator(e,t,r),this.getContinueAsNewRegex().exec(t.code)&&(e[t.name].isCalledByItself=!0);const i=this.getEventNames(t.code);for(const s of i){const i=this.getRaiseEventRegex(s);for(const n of l)i.exec(n.code)&&(e[t.name].isSignalledBy=e[t.name].isSignalledBy??[],e[t.name].isSignalledBy.push({name:n.name,signalName:s}))}}for(const t of c)for(const s of l)this.getSignalEntityRegex(t.name).exec(s.code)&&(e[t.name].isCalledBy=e[t.name].isCalledBy??[],e[t.name].isCalledBy.push(s.name));for(const t of l.concat(n).concat(a).concat(c))e[t.name].filePath=t.filePath,e[t.name].pos=t.pos,e[t.name].lineNr=t.lineNr;return e}getEventNames(e){const t=[],s=this.getWaitForExternalEventRegex();for(var i;i=s.regex.exec(e);)t.push(i[s.pos]);return t}mapActivitiesToOrchestrator(e,t,s){for(const i of s)this.getCallActivityRegex(i).exec(t.code)&&(e[i].isCalledBy=e[i].isCalledBy??[],e[i].isCalledBy.push(t.name))}tryExtractBindings(e){const t=[];if(!e)return t;const s=this.getBindingAttributeRegex();let n;for(;n=s.regex.exec(e);){const r="return:"===n[s.pos-1];let a=n[s.pos];a.endsWith("Attribute")&&(a=a.substring(0,a.length-9));const o=n.index+n[0].length,c=(0,i.getCodeInBrackets)(e,o,"(",")","").code;this.isOutRegex.lastIndex=o+c.length;const u=!!this.isOutRegex.exec(e);switch(a){case"read_blob":case"blob_input":case"blob_output":case"BlobInput":case"BlobOutput":case"Blob":{const e={type:"blob",direction:"Blob"===a?r||u?"out":"in":a.toLowerCase().endsWith("output")?"out":"in"},s=this.blobParamsRegex.exec(c);s&&(e.path=s[1]),t.push(e);break}case"blob_trigger":case"BlobTrigger":{const e={type:"blobTrigger"},s=this.blobParamsRegex.exec(c);s&&(e.path=s[1]),t.push(e);break}case"table_input":case"table_output":case"TableInput":case"TableOutput":case"Table":{const e={type:"table",direction:"Table"===a?r||u?"out":"in":a.toLowerCase().endsWith("output")?"out":"in"},s=this.singleParamRegex.exec(c);s&&(e.tableName=s[2]),t.push(e);break}case"CosmosDBInput":case"CosmosDBOutput":case"CosmosDB":{const e={type:"cosmosDB",direction:"CosmosDB"===a?r||u?"out":"in":a.toLowerCase().endsWith("output")?"out":"in"},s=this.cosmosDbParamsRegex.exec(c);s&&(e.databaseName=s[1],e.collectionName=s[3]),t.push(e);break}case"cosmos_db_trigger":case"CosmosDBTrigger":{const e={type:"cosmosDBTrigger"},s=this.singleParamRegex.exec(c);s&&(e.databaseName=s[2]),t.push(e);break}case"event_grid_output":case"EventGrid":case"EventGridOutput":{const e={type:"eventGrid",direction:"out"},s=this.eventGridParamsRegex.exec(c);s&&(e.topicEndpointUri=s[1],e.topicKeySetting=s[3]),t.push(e);break}case"EventGridTrigger":{const e={type:"eventGridTrigger"},s=this.eventGridParamsRegex.exec(c);s&&(e.topicEndpointUri=s[1],e.topicKeySetting=s[3]),t.push(e);break}case"event_hub_output":case"EventHub":case"EventHubOutput":{const e={type:"eventHub",direction:"out"},s=this.eventHubParamsRegex.exec(c);s&&(e.eventHubName=s[1]),t.push(e);break}case"event_hub_message_trigger":case"EventHubTrigger":{const e={type:"eventHubTrigger"},s=this.eventHubParamsRegex.exec(c);s&&(e.eventHubName=s[1]),t.push(e);break}case"Kafka":case"KafkaOutput":{const e={type:"kafka",direction:"out"},s=this.singleParamRegex.exec(c);s&&(e.brokerList=s[2]),t.push(e);break}case"KafkaTrigger":{const e={type:"kafkaTrigger"},s=this.singleParamRegex.exec(c);s&&(e.brokerList=s[2]),t.push(e);break}case"queue_output":case"Queue":case"QueueOutput":{const e={type:"queue",direction:"out"},s=this.singleParamRegex.exec(c);s&&(e.queueName=s[2]),t.push(e);break}case"queue_trigger":case"QueueTrigger":{const e={type:"queueTrigger"},s=this.singleParamRegex.exec(c);s&&(e.queueName=s[2]),t.push(e);break}case"service_bus_queue_output":case"service_bus_topic_output":case"ServiceBus":case"ServiceBusOutput":{const e={type:"serviceBus",direction:"out"},s=this.singleParamRegex.exec(c);s&&(e.queueName=s[2]),t.push(e);break}case"service_bus_queue_trigger":case"service_bus_topic_trigger":case"ServiceBusTrigger":case"ServiceBusQueueTrigger":case"ServiceBusTopicTrigger":{const e={type:"serviceBusTrigger"},s=this.singleParamRegex.exec(c);s&&(e.queueName=s[2]),t.push(e);break}case"SignalRConnectionInfo":case"SignalRConnectionInfoInput":{const e={type:"signalRConnectionInfo",direction:"in"},s=this.signalRConnInfoParamsRegex.exec(c);s&&(e.hubName=s[1]),t.push(e);break}case"SignalR":case"SignalROutput":{const e={type:"signalR",direction:"out"},s=this.signalRParamsRegex.exec(c);s&&(e.hubName=s[1]),t.push(e);break}case"SignalRTrigger":{const e={type:"signalRTrigger"},s=this.signalRParamsRegex.exec(c);s&&(e.hubName=s[1]),t.push(e);break}case"RabbitMQ":case"RabbitMQOutput":{const e={type:"rabbitMQ",direction:"out"},s=this.rabbitMqParamsRegex.exec(c);s&&(e.queueName=s[1]),t.push(e);break}case"RabbitMQTrigger":{const e={type:"rabbitMQTrigger"},s=this.rabbitMqParamsRegex.exec(c);s&&(e.queueName=s[1]),t.push(e);break}case"SendGrid":case"SendGridOutput":t.push({type:"sendGrid",direction:"out"});break;case"TwilioSms":t.push({type:"twilioSms",direction:"out"});break;case"route":case"HttpTrigger":{const e={type:"httpTrigger",methods:[]},s=this.httpTriggerRouteRegex.exec(c);s&&(e.route=s[1]);const i=c.toLowerCase();for(const t of this.httpMethods)i.includes(`"${t}"`)&&e.methods.push(t);/level.anonymous/i.exec(c)&&(e.authLevel="anonymous"),t.push(e),t.push({type:"http",direction:"out"});break}case"orchestration_trigger":case"OrchestrationTrigger":case"DurableOrchestrationTrigger":t.push({type:"orchestrationTrigger",direction:"in"});break;case"activity_trigger":case"ActivityTrigger":case"DurableActivityTrigger":t.push({type:"activityTrigger",direction:"in"});break;case"EntityTrigger":case"DurableEntityTrigger":t.push({type:"entityTrigger",direction:"in"});break;case"schedule":case"TimerTrigger":{const e={type:"timerTrigger"},s=this.singleParamRegex.exec(c);s&&(e.schedule=s[2]),t.push(e);break}case"OrchestrationClient":case"DurableClient":case"DurableClientInput":t.push({type:"durableClient",direction:"in"})}}return t}getBindingAttributeRegex(){return{regex:new RegExp("(\\[|@)(<)?\\s*(return:)?\\s*(\\w+)","g"),pos:4}}getStartNewOrchestrationRegex(e){return new RegExp(`(StartNew|StartNewAsync|start_new|scheduleNewOrchestrationInstance|scheduleNewOrchestrationInstanceAsync)(\\s*<[\\w\\.-\\[\\]\\<\\>,\\s]+>)?\\s*\\(\\s*(["'\`]|nameof\\s*\\(\\s*[\\w\\.-]*|[\\w\\s\\.]+\\.\\s*)${e}\\s*["'\\),]{1}`,"i")}getCallSubOrchestratorRegex(e){return new RegExp(`(CallSubOrchestrator|CallSubOrchestratorWithRetry|call_sub_orchestrator)(Async)?(\\s*<[\\w\\.-\\[\\]\\<\\>,\\s]+>)?\\s*\\(\\s*(["'\`]|nameof\\s*\\(\\s*[\\w\\.-]*|[\\w\\s\\.]+\\.\\s*)${e}\\s*["'\\),]{1}`,"i")}getContinueAsNewRegex(){return new RegExp("ContinueAsNew\\s*\\(","i")}getRaiseEventRegex(e){return new RegExp(`(RaiseEvent|raise_event)(Async)?(.|\r|\n)*${e}`,"i")}getSignalEntityRegex(e){return new RegExp(`${e}\\s*["'>]{1}`)}getWaitForExternalEventRegex(){return{regex:new RegExp("(WaitForExternalEvent|wait_for_external_event)(<[\\s\\w,\\.-\\[\\]\\(\\)\\<\\>]+>)?\\s*\\(\\s*(nameof\\s*\\(\\s*|[\"'`]|[\\w\\s\\.]+\\.\\s*)?([\\s\\w\\.-]+)\\s*[\"'`\\),]{1}","gi"),pos:4}}getCallActivityRegex(e){return new RegExp(`(CallActivity|call_activity)[\\s\\w,\\.-<>\\[\\]\\(\\)\\?]*\\([\\s\\w\\.-]*["'\`]?${e}\\s*["'\`\\),]{1}`,"i")}getClassDefinitionRegex(e){return new RegExp(`class\\s*${e}`)}}},6620:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionProjectScriptParser=void 0;const i=s(9293),n=s(5254);class r extends n.FunctionProjectParserBase{async traverseFunctions(e){let t;return t=await this._fileSystemWrapper.readFunctionsJson(e,this._log),t=await this.mapOrchestratorsAndActivitiesAsync(t,e),t}async getFunctionsAndTheirCodesAsync(e,t){const s=e.map((async e=>{let s=await this._fileSystemWrapper.findFileRecursivelyAsync(this._fileSystemWrapper.joinPath(t,e),"(index\\.ts|index\\.js|__init__\\.py)$",!0);if(!s)return;const n=s.pos?s.pos:0,r=(0,i.posToLineNr)(s.code,n);return{name:e,code:s.code,filePath:s.filePath,pos:n,lineNr:r}}));return(await Promise.all(s)).filter((e=>!!e))}}t.FunctionProjectScriptParser=r},6315:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JavaFunctionProjectParser=void 0;const i=s(9293),n=s(8466);class r extends n.FunctionProjectCodeParser{async getFunctionsAndTheirCodesAsync(e,t){const s=e.map((async e=>{const s=await this._fileSystemWrapper.findFileRecursivelyAsync(t,".+\\.java$",!0,this.getFunctionStartRegex(e));if(!s)return;const n=(0,i.getCodeInBrackets)(s.code,s.pos+s.length,"{","}","\n").code,r=s.pos?s.pos:0,a=(0,i.posToLineNr)(s.code,r);return{name:e,code:n,filePath:s.filePath,pos:r,lineNr:a}}));return(await Promise.all(s)).filter((e=>!!e))}async traverseProjectCode(e){const t={};for await(const s of this._fileSystemWrapper.findFunctionsRecursivelyAsync(e,new RegExp(".+\\.java$","i"),this.getFunctionAttributeRegex())){const e=this.tryExtractBindings(s.declarationCode);t[s.functionName]={filePath:s.filePath,pos:s.pos,lineNr:s.lineNr,bindings:[...e]}}return t}getFunctionAttributeRegex(){return{regex:new RegExp('@\\s*FunctionName\\s*\\((["\\w\\s\\.\\(\\)-]+)\\)',"g"),pos:1}}}t.JavaFunctionProjectParser=r},9852:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PowershellFunctionProjectParser=void 0;const i=s(9293),n=s(5254);class r extends n.FunctionProjectParserBase{async traverseFunctions(e){let t;return t=await this._fileSystemWrapper.readFunctionsJson(e,this._log),t=await this.mapOrchestratorsAndActivitiesAsync(t,e),t}async getFunctionsAndTheirCodesAsync(e,t){const s=e.map((async e=>{let s="run\\.ps1$";const n=await this._fileSystemWrapper.findFileRecursivelyAsync(this._fileSystemWrapper.joinPath(t,e),"function.json$",!0);if(n){const e=JSON.parse(n.code);e.scriptFile&&(s=e.scriptFile.replace(".","\\."))}const r=await this._fileSystemWrapper.findFileRecursivelyAsync(this._fileSystemWrapper.joinPath(t,e),s,!0);if(!r)return;const a=r.pos?r.pos:0,o=(0,i.posToLineNr)(r.code,a);return{name:e,code:r.code,filePath:r.filePath,pos:a,lineNr:o}}));return(await Promise.all(s)).filter((e=>!!e))}getStartNewOrchestrationRegex(e){return new RegExp(`(Start-DurableOrchestration|Start-NewOrchestration).*-FunctionName\\s*["']${e}["']`,"i")}getCallActivityRegex(e){return new RegExp(`(Invoke-DurableActivity|Invoke-ActivityFunction).*-FunctionName\\s*["']${e}["']`,"i")}getRaiseEventRegex(e){return new RegExp(`Send-DurableExternalEvent.*-EventName\\s*["']${e}["']`,"i")}getWaitForExternalEventRegex(){return{regex:new RegExp("Start-DurableExternalEventListener.*-EventName\\s*[\"']([\\s\\w\\.-]+)[\"']","gi"),pos:1}}}t.PowershellFunctionProjectParser=r},8249:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PythonV2FunctionProjectParser=void 0;const i=s(9293),n=s(8466);class r extends n.FunctionProjectCodeParser{async getFunctionsAndTheirCodesAsync(e,t){const s=e.map((async e=>{const s=await this._fileSystemWrapper.findFileRecursivelyAsync(t,".+\\.py$",!0,this.getFunctionStartRegex(e));if(!s)return;const{declarationCode:n,bodyCode:r}=this.getFunctionCode(s.code,s.pos),a=s.pos?s.pos:0,o=(0,i.posToLineNr)(s.code,a);return{name:e,code:r,filePath:s.filePath,pos:a,lineNr:o}}));return(await Promise.all(s)).filter((e=>!!e))}async traverseProjectCode(e){const t={};for await(const s of this.findFunctionsRecursivelyAsync(e)){const e=this.tryExtractBindings(s.declarationCode);t[s.functionName]={filePath:s.filePath,pos:s.pos,lineNr:s.lineNr,bindings:[...e]}}return t}async*findFunctionsRecursivelyAsync(e){const t=new RegExp(".+\\.py$","i"),s=this.getFunctionAttributeRegex(),n=new RegExp("\\.\\s*function_name\\s*\\(\\s*name\\s*=\\s*[\"']([\\w-]+)[\"']");for await(const r of this._fileSystemWrapper.findFilesRecursivelyAsync(e,t)){const e=await this._fileSystemWrapper.readFile(r);let t;for(;t=s.regex.exec(e);){let a=t[s.pos],{declarationCode:o,bodyCode:c}=this.getFunctionCode(e,t.index);const u=n.exec(o);u&&(a=u[1],o=o.replace("function_name","")),yield{functionName:a,filePath:r,pos:t.index,lineNr:(0,i.posToLineNr)(e,t.index),declarationCode:o,bodyCode:c}}}}getFunctionCode(e,t){let s="",i="";const n=new RegExp("^(async)?\\s*def ","gm"),r=new RegExp("^[^\\s]","gm");n.lastIndex=t;const a=n.exec(e);if(a){s=e.substring(t,a.index),t=a.index+a[0].length,r.lastIndex=t;const n=r.exec(e);i=n?e.substring(t,n.index):e.substring(t)}else s=e.substring(t),i=e.substring(t);return{declarationCode:s,bodyCode:i}}getFunctionAttributeRegex(){return{regex:new RegExp("@[\\w\\s]+\\.\\s*(function_name|route|blob_trigger|cosmos_db_trigger|event_hub_message_trigger|queue_trigger|service_bus_queue_trigger|service_bus_topic_trigger|orchestration_trigger|activity_trigger|schedule)(.|\r|\n)+?def\\s+([\\w-]+)","g"),pos:3}}getFunctionStartRegex(e){return new RegExp(`(@[\\w\\s]+\\.\\s*function_name\\s*\\(\\s*name\\s*=\\s*["']${e}["']|^(async)?\\s*def\\s+${e})`,"m")}getBindingAttributeRegex(){return{regex:new RegExp("@[\\w\\s]+\\.\\s*(\\w+)\\s*\\(","g"),pos:1}}getStartNewOrchestrationRegex(e){return new RegExp(`\\.\\s*start_new\\s*\\(\\s*["']${e}["']`)}}t.PythonV2FunctionProjectParser=r},9293:(e,t)=>{function s(e){if(!e)return e;const t=e.lastIndexOf(".");return t>=0&&(e=e.substring(t+1)),e.trim()}Object.defineProperty(t,"__esModule",{value:!0}),t.getCodeInBracketsReverse=t.getCodeInBrackets=t.posToLineNr=t.removeNamespace=t.cleanupFunctionName=void 0,t.cleanupFunctionName=function(e){if(!e)return e;const t=new RegExp("nameof\\s*\\(\\s*([\\w\\.]+)\\s*\\)").exec(e);return t?s(t[1]):(e=e.trim()).startsWith('"')?e.replace(/^"/,"").replace(/"$/,""):s(e)},t.removeNamespace=s,t.posToLineNr=function(e,t){if(!e)return 0;const s=e.substr(0,t).match(/(\r\n|\r|\n)/g);return s?s.length+1:1},t.getCodeInBrackets=function(e,t,s,i,n=""){for(var r=0,a=-1,o=!n,c=t;c<e.length;c++){switch(e[c]){case s:r<=0&&(a=c),r++;break;case i:if(--r<=0&&o)return{code:e.substring(t,c+1),openBracketPos:a-t}}r>0&&n.includes(e[c])&&(o=!0)}return{code:"",openBracketPos:-1}},t.getCodeInBracketsReverse=function(e,t,s){for(var i=0,n=0,r=e.length-1;r>=0;r--)switch(e[r]){case s:i<=0&&(n=r),i++;break;case t:if(--i<=0)return{code:e.substring(0,n+1),openBracketPos:r}}return{code:"",openBracketPos:-1}}},1398:e=>{e.exports=require("vscode")}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=s(1398),n=s(1559),r=s(9900);let a=[];const o=new n.FileSystemWrapper;async function c(e){if(!t.workspace.workspaceFolders)return;const s=[];try{for(const e of t.workspace.workspaceFolders)for await(const t of o.findFilesRecursivelyAsync(e.uri.toString(),new RegExp("host.json","i")))s.push(o.dirName(t));if(s.length>5&&"Yes"!==await t.window.showWarningMessage(`az-func-as-a-graph found ${s.length} Azure Functions projects in current workspace. Do you want to visualize all of them?`,"Yes","No"))return}catch(e){t.window.showErrorMessage(`az-func-as-a-graph failed. ${e.message??e}`)}for(const i of s)a.push(new r.FunctionGraphView(e,t.Uri.parse(i)))}e.activate=async function(e){e.subscriptions.push(t.commands.registerCommand("az-func-as-a-graph.ShowGraph",(async s=>{if(s){const i=s.toString();i.toLowerCase().endsWith("host.json")&&a.push(new r.FunctionGraphView(e,t.Uri.parse(o.dirName(i))))}else await c(e)}))),t.workspace.workspaceFolders&&t.workspace.getConfiguration("az-func-as-a-graph").get("showGraphAtStartup",!0)&&await c(e)},e.deactivate=function(){for(const e of a)e.cleanup()}})();var n=exports;for(var r in i)n[r]=i[r];i.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();